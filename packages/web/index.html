<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RSLH Filter Tools</title>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <main>
      <div class="header-row">
        <h1>RSLH Filter Tools</h1>
        <button id="guide-btn" class="guide-btn" type="button" title="User guide">Guide</button>
        <button id="about-btn" class="about-btn" type="button" title="About">About</button>
        <button id="feedback-btn" class="feedback-btn" type="button" title="Feedback">Feedback</button>
        <button id="settings-btn" class="settings-btn" type="button" title="Settings">Settings</button>
      </div>

      <nav class="tab-bar" id="tab-bar">
        <!-- Dynamic tabs and + button rendered by main.ts -->
      </nav>

      <!-- Tab-bar-level errors (e.g. max tabs) -->
      <div id="tab-bar-error" class="error-banner" hidden></div>

      <!-- Empty state shown when no tabs are open -->
      <div id="empty-state" class="empty-state" hidden>
        <p>No tabs open. Click <strong>+</strong> to get started.</p>
      </div>

      <div id="tab-content" class="tab-panels">
        <!-- Generator content -->
        <div id="generator-content" hidden>
          <div class="generator-toolbar">
            <button id="gen-generate-btn" type="button" class="gen-toolbar-btn gen-toolbar-btn-primary">Generate</button>
            <button id="gen-save-hsf-btn" type="button" class="gen-toolbar-btn">Save .hsf</button>
            <button id="gen-save-btn" type="button" class="gen-toolbar-btn">Save .fmbl</button>
            <div id="gen-load-drop" class="toolbar-drop-zone">
              <button id="gen-load-btn" type="button" class="gen-toolbar-btn toolbar-drop-btn" title="Click to browse or drag-and-drop a .fmbl file">Load .fmbl</button>
              <span class="toolbar-drop-icon" title="Drop .fmbl file here">&#8615;</span>
            </div>
            <input type="file" id="fmbl-input" accept=".fmbl" hidden />
          </div>
          <div id="groups-container"></div>
          <button id="gen-add-group" type="button" class="gen-add-group-btn">+ Add Group</button>
        </div>

        <!-- Quick Generator content -->
        <div id="quick-content" hidden>
          <div class="quick-toolbar">
            <button id="quick-generate-btn" type="button" class="gen-toolbar-btn gen-toolbar-btn-primary">Generate</button>
            <button id="quick-save-hsf-btn" type="button" class="gen-toolbar-btn">Save .hsf</button>
            <button id="quick-save-btn" type="button" class="gen-toolbar-btn">Save .fqbl</button>
            <div id="quick-load-drop" class="toolbar-drop-zone">
              <button id="quick-load-btn" type="button" class="gen-toolbar-btn toolbar-drop-btn" title="Click to browse or drag-and-drop a .fqbl file">Load .fqbl</button>
              <span class="toolbar-drop-icon" title="Drop .fqbl file here">&#8615;</span>
            </div>
            <input type="file" id="fqbl-input" accept=".fqbl" hidden />
            <button id="quick-share-btn" type="button" class="gen-toolbar-btn">Share</button>
            <button id="quick-strict-btn" type="button" class="gen-toolbar-btn" title="Strict mode: sell all items that don't match a keep rule">Strict</button>
          </div>
          <div id="quick-profiles"></div>
          <div id="quick-tiers"></div>
        </div>

        <!-- Viewer content -->
        <div id="viewer-content">
          <!-- Upload section -->
          <div id="drop-zone" class="drop-zone">
            <p>Drag &amp; drop a <strong>.hsf</strong> file here</p>
            <p>or <button id="browse-btn" type="button">browse</button></p>
            <input type="file" id="file-input" accept=".hsf" hidden />
          </div>

          <!-- Viewer toolbar (shown when a filter is loaded) -->
          <div id="viewer-toolbar" class="viewer-toolbar" hidden>
            <button id="viewer-edit-btn" type="button" class="gen-toolbar-btn">Edit</button>
            <button id="viewer-save-hsf-btn" type="button" class="gen-toolbar-btn" hidden>Save .hsf</button>
            <button id="viewer-add-rule-btn" type="button" class="gen-toolbar-btn" hidden>+ Add Rule</button>
            <button id="viewer-cancel-btn" type="button" class="gen-toolbar-btn" hidden>Cancel</button>
          </div>

          <!-- Error banner -->
          <div id="error-banner" class="error-banner" hidden></div>

          <!-- Filter summary -->
          <div id="filter-summary" hidden></div>

          <!-- Test panel -->
          <details id="test-panel" hidden>
            <summary>Test Item</summary>
            <div id="test-panel-body"></div>
          </details>

          <!-- Rules container -->
          <div id="rules-container"></div>

          <!-- Raw JSON collapsible -->
          <details id="raw-json" hidden>
            <summary>Raw JSON</summary>
            <pre></pre>
          </details>
        </div>
      </div>
    </main>

    <!-- About modal -->
    <div id="about-overlay" class="modal-overlay">
      <div class="modal" role="dialog" aria-labelledby="about-title">
        <button class="modal-close" id="about-close" type="button" aria-label="Close">&times;</button>
        <h2 id="about-title">About RSLH Filter Tools</h2>
        <p>
          A tool for generating and viewing <strong>.hsf</strong> artifact filter files
          for <strong>RSL Helper</strong>, a companion app for
          <em>Raid: Shadow Legends</em>.
        </p>
        <p>
          Huge thanks to Farbstoff for creating RSL Helper and making it
          available to the community. Check out
          his <a href="https://www.youtube.com/c/FarbstoffRSL" target="_blank" rel="noopener">YouTube channel</a>
          and consider subscribing!
        </p>
        <p>
          If you'd like to say thanks to me, consider checking out my
          <a href="https://www.youtube.com/@Vircengitorix/streams" target="_blank" rel="noopener">YouTube streams</a>
          or using my Aptoide promo code <strong id="about-promo-code">...</strong>
          when spending in game. Not sure what that is?
          Here's <a href="https://github.com/fumb13s/raid-guides/blob/main/aptoide.md" target="_blank" rel="noopener">a guide</a>.
        </p>
      </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-overlay" class="modal-overlay">
      <div class="modal settings-modal" role="dialog" aria-labelledby="settings-title">
        <button class="modal-close" id="settings-close" type="button" aria-label="Close">&times;</button>
        <h2 id="settings-title">Settings</h2>
        <div id="settings-body"></div>
      </div>
    </div>

    <!-- Guide modal -->
    <div id="guide-overlay" class="modal-overlay">
      <div class="modal guide-modal" role="dialog" aria-labelledby="guide-title">
        <button class="modal-close" id="guide-close" type="button" aria-label="Close">&times;</button>
        <h2 id="guide-title">User Guide</h2>
        <nav id="guide-toc" class="guide-toc"></nav>
        <div id="guide-content" class="guide-content"></div>
      </div>
    </div>

    <!-- Feedback modal (iframe fallback when Tally embed script is unavailable) -->
    <div id="feedback-overlay" class="modal-overlay">
      <div class="modal feedback-modal" role="dialog" aria-labelledby="feedback-title">
        <button class="modal-close" id="feedback-close" type="button" aria-label="Close">&times;</button>
        <iframe id="feedback-iframe" class="feedback-iframe" title="Feedback form"></iframe>
      </div>
    </div>

    <button id="back-to-top" class="back-to-top" hidden aria-label="Back to top">&uarr;</button>
    <script type="module" src="/src/main.ts"></script>

    <!-- GoatCounter analytics (privacy-friendly, no cookies) -->
    <script>
      if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
        var s = document.createElement('script');
        s.dataset.goatcounter = 'https://rslh-filter-gen.goatcounter.com/count';
        s.async = true;
        s.src = '//gc.zgo.at/count.js';
        document.body.appendChild(s);
      }
    </script>
    <noscript>
      <img src="https://rslh-filter-gen.goatcounter.com/count?p=/noscript"
           alt="" style="position:absolute;left:-9999px" />
    </noscript>
  </body>
</html>
