<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RSLH Filter Tools</title>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <main>
      <div class="header-row">
        <h1>RSLH Filter Tools</h1>
        <button id="guide-btn" class="guide-btn" type="button" title="User guide">Guide</button>
        <button id="about-btn" class="about-btn" type="button" title="About">?</button>
      </div>

      <nav class="tab-bar" id="tab-bar">
        <!-- Dynamic tabs and + button rendered by main.ts -->
      </nav>

      <!-- Tab-bar-level errors (e.g. max tabs) -->
      <div id="tab-bar-error" class="error-banner" hidden></div>

      <!-- Empty state shown when no tabs are open -->
      <div id="empty-state" class="empty-state" hidden>
        <p>No tabs open. Click <strong>+</strong> to get started.</p>
      </div>

      <div id="tab-content" class="tab-panels">
        <!-- Generator content -->
        <div id="generator-content" hidden>
          <div class="generator-toolbar">
            <button id="gen-generate-btn" type="button" class="gen-toolbar-btn gen-toolbar-btn-primary">Generate</button>
            <button id="gen-save-hsf-btn" type="button" class="gen-toolbar-btn">Save .hsf</button>
            <button id="gen-save-btn" type="button" class="gen-toolbar-btn">Save .fmbl</button>
            <div id="gen-load-drop" class="toolbar-drop-zone">
              <button id="gen-load-btn" type="button" class="gen-toolbar-btn toolbar-drop-btn" title="Click to browse or drag-and-drop a .fmbl file">Load .fmbl</button>
              <span class="toolbar-drop-icon" title="Drop .fmbl file here">&#8615;</span>
            </div>
            <input type="file" id="fmbl-input" accept=".fmbl" hidden />
          </div>
          <div id="groups-container"></div>
          <button id="gen-add-group" type="button" class="gen-add-group-btn">+ Add Group</button>
        </div>

        <!-- Quick Generator content -->
        <div id="quick-content" hidden>
          <div class="quick-toolbar">
            <button id="quick-generate-btn" type="button" class="gen-toolbar-btn gen-toolbar-btn-primary">Generate</button>
            <button id="quick-save-hsf-btn" type="button" class="gen-toolbar-btn">Save .hsf</button>
            <button id="quick-save-btn" type="button" class="gen-toolbar-btn">Save .fqbl</button>
            <div id="quick-load-drop" class="toolbar-drop-zone">
              <button id="quick-load-btn" type="button" class="gen-toolbar-btn toolbar-drop-btn" title="Click to browse or drag-and-drop a .fqbl file">Load .fqbl</button>
              <span class="toolbar-drop-icon" title="Drop .fqbl file here">&#8615;</span>
            </div>
            <input type="file" id="fqbl-input" accept=".fqbl" hidden />
          </div>
          <div id="quick-profiles"></div>
          <div id="quick-tiers"></div>
        </div>

        <!-- Viewer content -->
        <div id="viewer-content">
          <!-- Upload section -->
          <div id="drop-zone" class="drop-zone">
            <p>Drag &amp; drop a <strong>.hsf</strong> file here</p>
            <p>or <button id="browse-btn" type="button">browse</button></p>
            <input type="file" id="file-input" accept=".hsf" hidden />
          </div>

          <!-- Error banner -->
          <div id="error-banner" class="error-banner" hidden></div>

          <!-- Filter summary -->
          <div id="filter-summary" hidden></div>

          <!-- Test panel -->
          <details id="test-panel" hidden>
            <summary>Test Item</summary>
            <div id="test-panel-body"></div>
          </details>

          <!-- Rules container -->
          <div id="rules-container"></div>

          <!-- Raw JSON collapsible -->
          <details id="raw-json" hidden>
            <summary>Raw JSON</summary>
            <pre></pre>
          </details>
        </div>
      </div>
    </main>

    <!-- About modal -->
    <div id="about-overlay" class="modal-overlay">
      <div class="modal" role="dialog" aria-labelledby="about-title">
        <button class="modal-close" id="about-close" type="button" aria-label="Close">&times;</button>
        <h2 id="about-title">About RSLH Filter Tools</h2>
        <p>
          A tool for generating and viewing <strong>.hsf</strong> artifact filter files
          for <strong>RSL Helper</strong>, a companion app for
          <em>Raid: Shadow Legends</em>.
        </p>
        <p>
          Huge thanks to Farbstoff for creating RSL Helper and making it
          available to the community. Check out
          his <a href="https://www.youtube.com/c/FarbstoffRSL" target="_blank" rel="noopener">YouTube channel</a>
          and consider subscribing!
        </p>
        <p>
          If you'd like to say thanks to me, consider checking out my
          <a href="https://www.youtube.com/@Vircengitorix/streams" target="_blank" rel="noopener">YouTube streams</a>
          or using my Aptoide promo code <strong id="about-promo-code">...</strong>
          when spending in game. Not sure what that is?
          Here's <a href="https://github.com/fumb13s/raid-guides/blob/main/aptoide.md" target="_blank" rel="noopener">a guide</a>.
        </p>
      </div>
    </div>

    <!-- Guide modal -->
    <div id="guide-overlay" class="modal-overlay">
      <div class="modal guide-modal" role="dialog" aria-labelledby="guide-title">
        <button class="modal-close" id="guide-close" type="button" aria-label="Close">&times;</button>
        <h2 id="guide-title">User Guide</h2>

        <nav class="guide-toc">
          <a href="#guide-overview">Overview</a>
          <a href="#guide-quick">Quick Generator</a>
          <a href="#guide-viewer">Viewing Filters</a>
          <a href="#guide-manual">Manual Generator</a>
          <a href="#guide-formats">File Formats</a>
          <a href="#guide-tips">Tips</a>
        </nav>

        <div class="guide-content">
          <h3 id="guide-overview">Overview</h3>
          <p>
            RSLH Filter Tools creates and inspects <strong>.hsf</strong> artifact filter files
            for <strong>RSL Helper</strong>. It has three modes:
          </p>
          <ul>
            <li><strong>Quick Generator</strong> &mdash; fast, tier-based filter building (recommended starting point)</li>
            <li><strong>Manual Generator</strong> &mdash; full control over every rule parameter</li>
            <li><strong>Viewer</strong> &mdash; load and inspect any existing .hsf file</li>
          </ul>
          <p>
            Each mode opens in its own tab. Click the <strong>+</strong> button to add tabs,
            or use the <strong>&#9662;</strong> arrow to pick a specific tab type.
            You can also drag-and-drop files anywhere on the page &mdash; the correct tab type
            opens automatically.
          </p>

          <h3 id="guide-quick">Quick Generator</h3>
          <p>
            The Quick Generator lets you build a filter by sorting artifact sets into tiers.
          </p>
          <ul>
            <li><strong>Tiers</strong> &mdash; four columns (S / A / B / C). Each tier has a roll threshold
              that controls the minimum substat quality for that tier.</li>
            <li><strong>Moving sets</strong> &mdash; click a set chip to move it one tier to the right,
              right-click to move it left, or drag and drop between columns.</li>
            <li><strong>Roll thresholds</strong> &mdash; the number in each tier header is the minimum
              &ldquo;good roll&rdquo; count (see below). Edit it directly or use the spinner arrows.</li>
            <li><strong>Sell toggle</strong> &mdash; enable Sell on any tier to generate sell rules for
              artifacts that don&rsquo;t meet the threshold (instead of simply ignoring them).</li>
            <li><strong>Build profiles</strong> &mdash; checkboxes below the tiers control which champion
              build profiles generate rules. Each profile defines which substats count as
              &ldquo;good&rdquo; for that build (see below).</li>
            <li><strong>Blocks</strong> &mdash; use multiple blocks to apply different tier layouts
              to different content (e.g. one block for Clan Boss sets, another for Arena sets).</li>
            <li><strong>Generate</strong> &mdash; click Generate to produce the .hsf. This opens both
              a Generator tab (showing the intermediate rules) and a Viewer tab (showing the final filter).</li>
          </ul>

          <h4 id="guide-rolls">Understanding &ldquo;Good Rolls&rdquo;</h4>
          <p>
            A <strong>&ldquo;good roll&rdquo;</strong> is either a starting substat you
            want for the build, or an upgrade (at levels 4, 8, 12, 16) that lands on
            a substat you want. A fully upgraded 6&#9733; artifact has up to
            <strong>4 starting substats</strong>, <strong>1 starting roll</strong>
            if it&rsquo;s Mythical, plus <strong>4 upgrades</strong> at levels 4/8/12/16,
            for a maximum of <strong>9 total rolls</strong> spread across its substats.
          </p>
          <p>
            The <strong>roll threshold</strong> in each tier is the minimum number of good rolls
            an artifact needs (across all its substats combined) to be kept. For example,
            a tier with threshold <strong>7</strong> means: &ldquo;keep this artifact only
            if 7 out of its up to 9 possible rolls landed on stats I care about.&rdquo;
          </p>
          <p>
            <strong>Build profiles</strong> define which substats count as &ldquo;good.&rdquo;
            For instance:
          </p>
          <ul>
            <li><strong>ATK Nuker</strong> &mdash; ATK%, SPD, C.RATE, and C.DMG are good</li>
            <li><strong>Support</strong> &mdash; HP%, DEF%, SPD, RES, and ACC are good</li>
          </ul>
          <p>
            The tool generates rules for every possible way the required rolls could be
            distributed across the good stats. For example, with the ATK Nuker profile
            and a threshold of <strong>3</strong>, it creates rules for distributions like:
          </p>
          <ul>
            <li>3 rolls in ATK%, 0 in anything else</li>
            <li>2 in ATK%, 1 in SPD</li>
            <li>1 in ATK%, 1 in C.RATE, 1 in C.DMG</li>
            <li>&hellip;and every other combination that totals 3</li>
          </ul>
          <p>
            An artifact is kept if <em>any one</em> of those distributions is satisfied.
            This means a piece with 2 rolls into C.RATE and 1 into SPD passes a
            threshold of 3 just as well as one with all 3 in ATK%.
          </p>
          <p>
            Rules are also created at lower level checkpoints (12, 8, 4) with reduced
            thresholds, so artifacts that haven&rsquo;t been fully upgraded yet are
            evaluated fairly &mdash; a level-8 piece only needs to meet a lower bar
            because it hasn&rsquo;t had all its upgrade chances.
          </p>

          <h4 id="guide-ore">Ore Reroll</h4>
          <p>
            The Ore Reroll section (inside the Quick Generator) creates rules for artifacts
            you plan to reroll at the Forge.
          </p>
          <ul>
            <li><strong>Columns</strong> &mdash; assign sets to the 3-roll, 4-roll, or 5-roll column
              based on how many good substats you require before keeping a rerolled piece.</li>
            <li>Sets in the Ignore column produce no ore-reroll rules.</li>
            <li>Generated rules use Keep so matching pieces are flagged for rerolling rather than sold.</li>
          </ul>

          <h4 id="guide-rare">Rare Accessories</h4>
          <p>
            Some accessory set + faction combinations are so hard to come by (e.g. Mercurial)
            that you want to keep every piece regardless of substats. The Rare Accessories
            grid lets you mark those combinations for unconditional keeping.
          </p>
          <ul>
            <li>Each row is an artifact set; each column is a faction.</li>
            <li><strong>Row header</strong> &mdash; click a set name to toggle all factions for that set.</li>
            <li><strong>Column header</strong> &mdash; click a faction name to toggle all sets for that faction.</li>
            <li>Checked cells generate unconditional Keep rules &mdash; any accessory from that
              set + faction is kept regardless of substats.</li>
          </ul>

          <h3 id="guide-viewer">Viewing Filters</h3>
          <p>
            The Viewer lets you load and inspect any .hsf file.
          </p>
          <ul>
            <li><strong>Loading</strong> &mdash; drag-and-drop a .hsf file onto the drop zone, or click Browse.</li>
            <li><strong>Summary bar</strong> &mdash; shows total rules, keep/sell breakdown, and active/inactive counts.</li>
            <li><strong>Rule cards</strong> &mdash; each rule is displayed as a card with set, slot, main stat, rarity,
              substats, and action (Keep/Sell). Click the &ldquo;Raw&rdquo; badge to see the underlying JSON.</li>
            <li><strong>Test Item</strong> &mdash; expand the Test Item panel to simulate an artifact against
              the loaded filter. Pick a set, slot, rarity, main stat, and substats, then click Test
              to see which rule matches (if any).</li>
          </ul>

          <h3 id="guide-manual">Manual Generator</h3>
          <p>
            The Manual Generator gives full control over every rule field.
          </p>
          <ul>
            <li><strong>Groups</strong> &mdash; each group becomes one or more .hsf rules. Add groups
              with the &ldquo;+ Add Group&rdquo; button.</li>
            <li><strong>Sets &amp; slots</strong> &mdash; use the searchable dropdown to pick artifact sets
              and the checkboxes for slots.</li>
            <li><strong>Main stats &amp; substats</strong> &mdash; check the stats you want. Use the preset
              buttons (ATK, DEF, HP, SPD, etc.) for quick selection.</li>
            <li><strong>Rank toggle</strong> &mdash; switch between 5&#9733; and 6&#9733; rules.</li>
            <li><strong>Roll slider</strong> &mdash; set the minimum substat roll threshold (0&ndash;8).</li>
          </ul>

          <h3 id="guide-formats">File Formats</h3>
          <ul>
            <li><strong>.hsf</strong> &mdash; the RSL Helper filter file. This is what you import into the app.</li>
            <li><strong>.fqbl</strong> &mdash; Quick Generator save file. Stores your tier assignments,
              profiles, and ore-reroll/rare-accessory settings so you can reload them later.</li>
            <li><strong>.fmbl</strong> &mdash; Manual Generator save file. Stores your groups and rule settings.</li>
          </ul>
          <p>
            Drag-and-drop any of these files onto the page &mdash; the tool automatically detects
            the format and opens the correct tab type.
          </p>

          <h3 id="guide-tips">Tips</h3>
          <ul>
            <li><strong>Start with Quick Gen</strong> &mdash; it covers most use cases. Switch to Manual
              only if you need fine-grained control over individual rules.</li>
            <li><strong>Use blocks</strong> for different content &mdash; e.g. one block for Clan Boss sets
              with strict thresholds, another for Arena sets with looser ones.</li>
            <li><strong>Verify in the Viewer</strong> &mdash; after generating, check the Viewer tab to
              confirm the rules look right. Use the Test Item panel to spot-check edge cases.</li>
            <li><strong>Sell toggle</strong> &mdash; only enable this if you want RSL Helper to actively
              mark non-matching artifacts for sale. Without it, unmatched pieces are simply ignored.</li>
            <li><strong>Save your work</strong> &mdash; use Save .fqbl / Save .fmbl to keep your settings.
              You can reload them later without rebuilding from scratch.</li>
          </ul>
        </div>
      </div>
    </div>

    <button id="back-to-top" class="back-to-top" hidden aria-label="Back to top">&uarr;</button>
    <script type="module" src="/src/main.ts"></script>

    <!-- GoatCounter analytics (privacy-friendly, no cookies) -->
    <script>
      if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
        var s = document.createElement('script');
        s.dataset.goatcounter = 'https://rslh-filter-gen.goatcounter.com/count';
        s.async = true;
        s.src = '//gc.zgo.at/count.js';
        document.body.appendChild(s);
      }
    </script>
    <noscript>
      <img src="https://rslh-filter-gen.goatcounter.com/count?p=/noscript"
           alt="" style="position:absolute;left:-9999px" />
    </noscript>
  </body>
</html>
